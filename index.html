<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Get Coins - Custom</title>
  <link href="style.css" rel="stylesheet"/>
  <link rel="manifest" href="manifest.json">

  <script>
    const session = localStorage.getItem("active_session");
    if (!session) {
      window.location.href = "login.html";
    } else {
      const data = JSON.parse(session);
      if (Date.now() > data.expiry) {
        localStorage.removeItem("active_session");
        window.location.href = "login.html";
      }
    }
  </script>

  <style>
    /* ===============================
       ORDER SUMMARY (BOTTOM SHEET)
    ================================ */
    .order-summary-modal {
      position: fixed; inset: 0; background: rgba(0,0,0,0.45);
      display: flex; justify-content: center; align-items: flex-end;
      opacity: 0; visibility: hidden; pointer-events: none;
      transition: opacity 0.3s ease; z-index: 2000;
    }
    .order-summary-modal.active { opacity: 1; visibility: visible; pointer-events: auto; }

    .order-summary-content {
      background: #fff; width: 100%; max-width: 480px; padding: 26px 24px 22px;
      border-top-left-radius: 20px; border-top-right-radius: 20px;
      box-shadow: 0 -4px 25px rgba(0,0,0,0.15); font-family: 'Segoe UI', sans-serif;
      transform: translateY(110%); opacity: 0.98;
      transition: transform 0.35s cubic-bezier(0.25, 0.8, 0.25, 1), opacity 0.35s ease;
    }
    .order-summary-modal.active .order-summary-content { transform: translateY(0); opacity: 1; }

    .summary-title { font-size: 1.4em; font-weight: 700; text-align: center; margin-bottom: 15px; }
    .summary-item { display: flex; justify-content: space-between; margin: 8px 0; font-weight: 600; }
    .divider { height: 1px; background: #e3e3e3; margin: 15px 0; }
    .payment-method { display: flex; align-items: center; justify-content: space-between; }
    .payment-method img { height: 24px; }
    .pay-now-btn {
      width: 100%; background: linear-gradient(90deg, #fe2c55, #ff4d67);
      color: #fff; border: none; padding: 15px; border-radius: 12px;
      font-weight: 600; margin-top: 22px; cursor: pointer; transition: 0.3s;
    }
    .purchase-note { text-align: center; font-size: 0.88em; color: #777; margin-top: 15px; }
    .close-summary { position: absolute; top: 12px; right: 18px; font-size: 26px; cursor: pointer; }

    /* ===============================
       PROFILE SETTINGS (RED THEME)
    ================================ */
    .tiktok-font {
      font-family: 'Proxima Nova', 'SF Pro Display', sans-serif;
      letter-spacing: -0.5px;
    }

    .settings-modal {
      position: fixed; inset: 0; background: rgba(0,0,0,0.8);
      display: none; justify-content: center; align-items: center; z-index: 5000;
      backdrop-filter: blur(5px);
    }
    .settings-modal.active { display: flex; }

    .settings-card {
      background: #121212; width: 90%; max-width: 400px; padding: 32px;
      border-radius: 20px; border: 1px solid rgba(255,255,255,0.1); color: white;
      position: relative;
    }

    .settings-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .settings-header h3 { font-size: 24px; font-weight: 800; margin: 0; }

    .secret-trigger { color: #222; cursor: pointer; font-size: 14px; user-select: none; }

    .settings-field { margin-bottom: 20px; }
    .settings-field label { display: block; font-size: 14px; font-weight: 600; color: #bbb; margin-bottom: 8px; }
    .settings-field input {
      width: 100%; padding: 14px; border: 1px solid #333; border-radius: 12px;
      background: #1f1f1f; color: white; box-sizing: border-box; font-size: 16px; outline: none;
    }
    .settings-field input:focus { border-color: #fe2c55; }

    .upload-btn {
      display: flex; align-items: center; justify-content: center; gap: 8px;
      background: #2f2f2f; color: white; padding: 12px; border-radius: 12px;
      cursor: pointer; font-weight: 600; font-size: 14px; border: 1px dashed #555;
    }

    .red-btn {
      width: 100%; background: #fe2c55; color: white; border: none; padding: 16px;
      border-radius: 14px; font-size: 17px; font-weight: 700; cursor: pointer;
    }

    .cancel-link {
      width: 100%; background: transparent; color: #888; border: none;
      padding: 12px; font-size: 15px; cursor: pointer; margin-top: 8px;
    }

    /* Gear Position */
    .recharge-box { position: relative; }
    .settings-gear { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); cursor: pointer; opacity: 0.6; }
  </style>
</head>
<body>

  <div class="main-card">
    <div class="top-header">
      <img class="back-icon" src="back-arrow.png" alt="Back"/>
      <h2 class="header">Get Coins</h2>
      <img class="history-icon" src="history.png" alt="History"/>
    </div>

    <div class="recharge-box">
      <img class="custom-icon" id="displayAvatar" src="tiktok-logo-icon.png" alt="icon"/>
      <div class="recharge-right">
        <p class="recharge-label" id="displayName">fimpong34</p>
        <p class="recharge-value">
          <img class="coin-icon" src="tiktok-coin.png" alt="coin"/>
          <span class="coins" id="displayBalance">3,919,237.29</span>
        </p>
      </div>
      <img src="https://img.icons8.com/ios-glyphs/24/777777/settings--v1.png" class="settings-gear" id="openSettings" alt="settings"/>
    </div>

    <input type="text" class="username-input" placeholder="Enter Username"/>

    <div class="recharge-info">
      <p class="recharge-line">Recharge:</p>
      <p class="save-note">Save up to 31% compared to in-app purchase</p>
    </div>

    <div class="coin-options">
      <div class="option" data-coins="70" data-price="0.74"><img src="tiktok-coin.png"/>70<br/><span>$0.74</span></div>
      <div class="option" data-coins="350" data-price="3.70"><img src="tiktok-coin.png"/>350<br/><span>$3.70</span></div>
      <div class="option" data-coins="700" data-price="7.40"><img src="tiktok-coin.png"/>700<br/><span>$7.40</span></div>
      <div class="option" data-coins="1400" data-price="14.80"><img src="tiktok-coin.png"/>1,400<br/><span>$14.80</span></div>
      <div class="option" data-coins="3500" data-price="37.00"><img src="tiktok-coin.png"/>3,500<br/><span>$37.00</span></div>
      <div class="option" data-coins="7000" data-price="74.00"><img src="tiktok-coin.png"/>7,000<br/><span>$74.00</span></div>
      <div class="option" data-coins="17500" data-price="185.00"><img src="tiktok-coin.png"/>17,500<br/><span>$185.00</span></div>
      <div class="option custom"><img src="tiktok-coin.png"/>Custom<br/><small>Large amount supported</small></div>
    </div>

    <div class="payment-icons-left">
      <img src="https://img.icons8.com/color/36/visa.png" alt="Visa"/>
      <img src="https://img.icons8.com/color/36/mastercard.png" alt="MasterCard"/>
      <img src="https://img.icons8.com/color/36/paypal.png" alt="PayPal"/>
      <img src="https://img.icons8.com/fluency/36/bank-card-back-side.png" alt="Card"/>
    </div>

    <div class="total-box-left">
      <p>Total: $<span id="total">0.00</span></p>
    </div>

    <button class="recharge-btn" disabled>Recharge</button>
  </div>

  <div class="custom-modal" id="customModal">
    <div class="custom-content">
      <div class="custom-header">
        <h3>Custom</h3>
        <span class="close-btn">&times;</span>
      </div>
      <p class="coin-label">Number of Coins</p>
      <div class="coin-display">
        <img src="tiktok-coin.png" alt="coin"/>
        <span id="coinValue">0</span>
      </div>
      <div class="num-pad">
        <button>1</button><button>2</button><button>3</button><button class="clear">☒</button>
        <button>4</button><button>5</button><button>6</button><button>000</button>
        <button>7</button><button>8</button><button>9</button><button>0</button>
      </div>
      <div class="custom-total">
        <p>Total: $<span id="customTotal">0.00</span></p>
      </div>
      <button class="recharge-btn" id="customRechargeBtn">Recharge</button>
    </div>
  </div>

  <div class="order-summary-modal" id="orderSummaryModal">
    <div class="order-summary-content">
      <span class="close-summary">&times;</span>
      <h3 class="summary-title">Order Summary</h3>
      <div class="summary-item">Username: <span id="summaryUsername">@user</span></div>
      <div class="summary-item">Coins: <span id="summaryCoins">0</span></div>
      <div class="summary-item">Total: <span id="summaryTotal">$0.00</span></div>
      <div class="divider"></div>
      <div class="payment-method">
        <img src="https://img.icons8.com/color/48/visa.png" alt="Visa"/>
        <div class="card-text">Visa •••• •••• 6422</div>
      </div>
      <div class="purchase-note">
        By tapping <strong>Pay Now</strong>, you agree to our <a href="#">Terms</a> and <a href="#">Privacy Policy</a>.
      </div>
      <button class="pay-now-btn">Pay Now</button>
    </div>
  </div>

  <div class="processing-modal" id="processingModal">
    <div class="processing-content">
      <div class="processing-logo"><img src="tiktok-loader.gif" class="processing-img"/></div>
      <p class="processing-title">Processing your payment</p>
      <p class="processing-timer" id="processingTimer">04:59</p>
    </div>
  </div>

  <div class="confirmation-modal" id="confirmationModal">
    <div class="confirmation-content">
      <img src="sucess.png" alt="Success" style="width: 80px;"/>
      <h3 class="confirmation-title">Payment Completed</h3>
      <p class="confirmation-text">You recharged <strong id="confirmationCoins">0 Coins</strong>.</p>
      <button class="go-back-btn" onclick="closeConfirmation()">Go back</button>
    </div>
  </div>

  <div class="settings-modal" id="settingsModal">
    <div class="settings-card">
      <div class="settings-header">
        <h3 class="tiktok-font">Edit Profile</h3>
        <span id="adminLock" class="secret-trigger">?</span>
      </div>
      <div class="settings-field">
        <label class="tiktok-font">Username</label>
        <input type="text" id="inputName" placeholder="Enter new name...">
      </div>
      <div class="settings-field">
        <label class="tiktok-font">Coin Balance</label>
        <input type="text" id="inputBalance" placeholder="e.g. 5,000,000">
      </div>
      <div class="settings-field">
        <label class="tiktok-font">Profile Photo</label>
        <input type="file" id="inputAvatarFile" accept="image/*" style="display: none;">
        <label for="inputAvatarFile" class="upload-btn">
          <img src="https://img.icons8.com/material-outlined/24/ffffff/upload.png" style="width:18px;"/> Upload Image
        </label>
      </div>
      <button class="save-settings-btn red-btn tiktok-font" id="saveSettings">Save Changes</button>
      <button class="cancel-link tiktok-font" id="closeSettings">Not now</button>
    </div>
  </div>

  <script>
    // --- Selectors ---
    const options = document.querySelectorAll('.option');
    const totalDisplay = document.getElementById('total');
    const rechargeBtn = document.querySelector('.recharge-btn');
    const usernameInput = document.querySelector('.username-input');
    const summaryModal = document.getElementById('orderSummaryModal');
    const summaryUsername = document.getElementById('summaryUsername');
    const summaryCoins = document.getElementById('summaryCoins');
    const summaryTotal = document.getElementById('summaryTotal');
    const payNowBtn = document.querySelector('.pay-now-btn');
    const processingModal = document.getElementById('processingModal');
    const confirmationModal = document.getElementById('confirmationModal');
    const confirmationCoins = document.getElementById('confirmationCoins');

    let selectedCoins = 0;
    let selectedPrice = 0;

    // --- Coin Selection ---
    options.forEach(option => {
      option.addEventListener('click', () => {
        if(option.classList.contains('custom')) return;
        options.forEach(o => o.classList.remove('active'));
        option.classList.add('active');
        selectedCoins = option.getAttribute('data-coins');
        selectedPrice = option.getAttribute('data-price');
        totalDisplay.textContent = parseFloat(selectedPrice).toFixed(2);
        rechargeBtn.disabled = false;
      });
    });

    rechargeBtn.addEventListener('click', () => {
      const username = usernameInput.value.trim() || "Unknown";
      summaryUsername.textContent = '@' + username;
      summaryCoins.textContent = selectedCoins + ' Coins';
      summaryTotal.textContent = '$' + parseFloat(selectedPrice).toFixed(2);
      summaryModal.classList.add('active');
    });

    // --- Custom Modal Logic ---
    const customOption = document.querySelector('.option.custom');
    const customModal = document.getElementById('customModal');
    const coinValue = document.getElementById('coinValue');
    const customTotal = document.getElementById('customTotal');
    const customRechargeBtn = document.getElementById('customRechargeBtn');
    let enteredValue = "";

    customOption.addEventListener('click', () => {
      customModal.classList.add('active');
      enteredValue = "";
      coinValue.textContent = "0";
      customTotal.textContent = "0.00";
    });

    document.querySelectorAll('.num-pad button').forEach(btn => {
      btn.addEventListener('click', () => {
        const val = btn.textContent.trim();
        if (val === "☒") enteredValue = enteredValue.slice(0, -1);
        else if (val === "000") enteredValue += "000";
        else enteredValue += val;
        
        coinValue.textContent = (enteredValue || "0").replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        customTotal.textContent = (parseInt(enteredValue || 0) * 0.01).toFixed(2);
      });
    });

    customRechargeBtn.addEventListener('click', () => {
      selectedCoins = coinValue.textContent;
      selectedPrice = customTotal.textContent;
      const username = usernameInput.value.trim() || "Unknown";
      summaryUsername.textContent = '@' + username;
      summaryCoins.textContent = selectedCoins + ' Coins';
      summaryTotal.textContent = '$' + selectedPrice;
      customModal.classList.remove('active');
      summaryModal.classList.add('active');
    });

    // --- Profile Settings Logic ---
    const settingsModal = document.getElementById('settingsModal');
    document.getElementById('openSettings').addEventListener('click', () => settingsModal.classList.add('active'));
    document.getElementById('closeSettings').addEventListener('click', () => settingsModal.classList.remove('active'));

    document.getElementById('saveSettings').addEventListener('click', () => {
      const name = document.getElementById('inputName').value;
      const bal = document.getElementById('inputBalance').value;
      const file = document.getElementById('inputAvatarFile').files[0];

      if (name) document.getElementById('displayName').textContent = name;
      if (bal) document.getElementById('displayBalance').textContent = bal;
      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => document.getElementById('displayAvatar').src = e.target.result;
        reader.readAsDataURL(file);
      }
      settingsModal.classList.remove('active');
    });

    // Admin Access Code 0015
    document.getElementById('adminLock').addEventListener('click', () => {
      if (prompt("Security Check:") === "0015") window.location.href = "admin.html";
    });

    // --- Payment Process ---
    payNowBtn.addEventListener('click', () => {
      summaryModal.classList.remove('active');
      processingModal.classList.add('active');
      confirmationCoins.textContent = summaryCoins.textContent;
      
      setTimeout(() => {
        processingModal.classList.remove('active');
        confirmationModal.classList.add('active');
      }, 3000);
    });

    function closeConfirmation() {
      confirmationModal.classList.remove('active');
      usernameInput.value = "";
      totalDisplay.textContent = "0.00";
      rechargeBtn.disabled = true;
      options.forEach(o => o.classList.remove('active'));
    }

    // --- UI Closers ---
    document.querySelector('.close-summary').onclick = () => summaryModal.classList.remove('active');
    document.querySelector('.close-btn').onclick = () => customModal.classList.remove('active');

    // Security
    document.addEventListener("keydown", (e) => {
      if (e.ctrlKey && (e.key === "u" || e.key === "U" || e.key === "i")) {
        e.preventDefault();
        window.location.href = "error.html";
      }
      if (e.key === "F12") {
        e.preventDefault();
        window.location.href = "error.html";
      }
    });
    document.addEventListener("contextmenu", (e) => {
      e.preventDefault();
      window.location.href = "error.html";
    });
  </script>
</body>
</html>